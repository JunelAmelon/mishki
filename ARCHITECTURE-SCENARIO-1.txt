================================================================================
  MISHKI - SCÃ‰NARIO 1 : APPLICATIONS SÃ‰PARÃ‰ES AVEC BACKEND CENTRALISÃ‰
================================================================================

ğŸŒ VUE D'ENSEMBLE SIMPLE
================================================================================

Imaginez MISHKI comme un restaurant avec DEUX ENTRÃ‰ES DIFFÃ‰RENTES :

1. ENTRÃ‰E GRAND PUBLIC (B2C) - Pour Mme Tout-le-monde
   - Jolie vitrine marketing
   - Achats Ã  l'unitÃ©
   - Prix TTC (taxes incluses)
   - Paiement immÃ©diat par carte

2. ENTRÃ‰E PROFESSIONNELLE (B2B) - Pour les SPA et instituts de beautÃ©
   - Interface sobre, fonctionnelle
   - Achats en gros (formats cabine)
   - Prix HT + remises nÃ©gociÃ©es
   - Paiement sur facture Ã  30 jours

MAIS : Les deux entrÃ©es mÃ¨nent Ã  la MÃŠME CUISINE (backend) et utilisent les 
MÃŠMES INGRÃ‰DIENTS (catalogue produits).


ğŸ“Š ARCHITECTURE DÃ‰TAILLÃ‰E
================================================================================

                              INTERNET
                                 |
                 +---------------+---------------+
                 |                               |
        +-------------------+          +-------------------+
        | www.mishki.com    |          | pro.mishki.com    |
        |                   |          |                   |
        | Site B2C          |          | Portail B2B       |
        | (apps/b2c)        |          | (apps/b2b)        |
        |                   |          |                   |
        | â€¢ Page d'accueil  |          | â€¢ Login obligatoire|
        | â€¢ Catalogue       |          | â€¢ Dashboard pro   |
        | â€¢ Blog beautÃ©     |          | â€¢ Commande rapide |
        | â€¢ Panier          |          | â€¢ Mes factures    |
        | â€¢ Paiement Stripe |          | â€¢ Demande de devis|
        | â€¢ Compte optionnel|          | â€¢ Suivi stock     |
        +-------------------+          +-------------------+
                 |                               |
                 +---------------+---------------+
                                 |
        +-------------------------------------------------------+
        |      PACKAGES PARTAGÃ‰S (packages/shared)              |
        |                                                       |
        | ğŸ“¦ types/                                             |
        |   â”œâ”€â”€ Product.ts       â† DÃ©finition d'un produit     |
        |   â”œâ”€â”€ User.ts          â† DÃ©finition utilisateur      |
        |   â””â”€â”€ Order.ts         â† DÃ©finition commande         |
        |                                                       |
        | ğŸ¨ ui/                                                |
        |   â”œâ”€â”€ Button.tsx       â† Bouton rÃ©utilisable         |
        |   â”œâ”€â”€ Card.tsx         â† Carte produit               |
        |   â”œâ”€â”€ Input.tsx        â† Champ de formulaire         |
        |   â””â”€â”€ Badge.tsx        â† Badge statut                |
        |                                                       |
        | ğŸ”§ utils/                                             |
        |   â”œâ”€â”€ formatPrice.ts   â† 45.50 â†’ "45,50 â‚¬"          |
        |   â”œâ”€â”€ calcTVA.ts       â† Calcul taxe                |
        |   â””â”€â”€ validators.ts    â† Validation email, SIRET     |
        |                                                       |
        | ğŸŒ api-client/                                        |
        |   â”œâ”€â”€ products.ts      â† getProducts(), getById()    |
        |   â”œâ”€â”€ auth.ts          â† login(), register()         |
        |   â””â”€â”€ orders.ts        â† createOrder(), getOrders()  |
        +-------------------------------------------------------+
                                 |
        +-------------------------------------------------------+
        |           BACKEND UNIQUE (Supabase)                   |
        |                                                       |
        | ğŸ—„ï¸  BASE DE DONNÃ‰ES PostgreSQL                       |
        |                                                       |
        | ğŸ“‹ Table: products                                    |
        | +----+--------------+---------+---------+-------+     |
        | | id | name         |price_b2c|price_b2b| stock |     |
        | +----+--------------+---------+---------+-------+     |
        | | 1  | CrÃ¨me Visage |  52.00  |  39.00  |  150  |     |
        | | 2  | SÃ©rum Anti-Ã¢ge|  78.00  |  58.50  |   85  |     |
        | | 3  | Gommage Corps|  38.00  |  28.50  |  200  |     |
        | +----+--------------+---------+---------+-------+     |
        |                                                       |
        | ğŸ‘¤ Table: users                                       |
        | +----+--------+------+------+----------+-------+      |
        | | id | email  | role |siret |validated |remise |      |
        | +----+--------+------+------+----------+-------+      |
        | | 1  |marie@..| b2c  | null |   true   |  0%   |      |
        | | 2  |spa@... | b2b  |12345.|   true   | 15%   |      |
        | | 3  |pro@... | b2b  |67890.|  false   |  0%   |      |
        | +----+--------+------+------+----------+-------+      |
        |                                                       |
        | ğŸ›’ Table: orders                                      |
        | ğŸ“„ Table: invoices (B2B uniquement)                  |
        | ğŸ“¸ Storage: product-images/                          |
        | ğŸ“ Storage: b2b-documents/ (KBIS, piÃ¨ces ID)         |
        |                                                       |
        | ğŸ” AUTH                                               |
        | â€¢ Email/Password pour tous                            |
        | â€¢ OAuth Google (B2C)                                  |
        | â€¢ Validation manuelle admin (B2B)                     |
        +-------------------------------------------------------+


ğŸ¬ SCÃ‰NARIOS D'UTILISATION
================================================================================

SCÃ‰NARIO A : Cliente B2C - "Sophie achÃ¨te une crÃ¨me"
--------------------------------------------------------------------------------
1. Sophie va sur www.mishki.com
2. Voit la page d'accueil marketing avec belles images
3. Clique sur "CrÃ¨me Visage Pro" â†’ voit 52,00 â‚¬ TTC
4. Ajoute au panier (stockÃ© dans navigateur)
5. CrÃ©e un compte rapide (email + mot de passe)
6. Paie par Stripe â†’ reÃ§oit email confirmation
7. Backend crÃ©e une commande avec role: b2c


SCÃ‰NARIO B : GÃ©rante de SPA B2B - "Marie commande 50 crÃ¨mes"
--------------------------------------------------------------------------------
1. Marie va sur pro.mishki.com
2. Est redirigÃ©e vers /login (protÃ©gÃ©)
3. Se connecte avec ses identifiants pro
4. Voit son dashboard : remise 15%, factures en attente
5. Va sur "Commande Rapide"
6. Cherche "CrÃ¨me Visage Pro" â†’ voit 39,00 â‚¬ HT (au lieu de 52â‚¬)
7. Entre quantitÃ© : 50
8. Valide â†’ CrÃ©e un devis (pas de paiement immÃ©diat)
9. Mishki admin valide â†’ gÃ©nÃ¨re facture
10. Marie paie sous 30 jours par virement


SCÃ‰NARIO C : Nouveau Pro - "Institut Zen s'inscrit"
--------------------------------------------------------------------------------
1. Institut Zen va sur pro.mishki.com/inscription
2. Remplit formulaire :
   - Nom sociÃ©tÃ©, SIRET
   - Upload KBIS (stockÃ© sur Supabase Storage)
   - Upload piÃ¨ce d'identitÃ© gÃ©rante
3. Soumet inscription â†’ validated: false en BDD
4. ReÃ§oit message : "En attente de validation"
5. Admin Mishki reÃ§oit notification
6. VÃ©rifie documents â†’ clique "Valider" â†’ validated: true
7. Institut Zen reÃ§oit email : "Compte activÃ© !"
8. Peut maintenant commander


ğŸ’ CE QUI EST PARTAGÃ‰ vs CE QUI EST DIFFÃ‰RENT
================================================================================

âœ… PARTAGÃ‰ (packages/shared)
--------------------------------------------------------------------------------

// packages/shared/types/Product.ts
export interface Product {
  id: string;
  name: string;
  description: string;
  price_b2c: number;      // Prix public TTC
  price_b2b: number;      // Prix pro HT
  category: string;
  stock: number;
  image_url: string;
  format_cabin?: string;  // Ex: "500ml format cabine"
}

// packages/shared/ui/Button.tsx
export function Button({ children, variant = 'primary' }) {
  // Bouton utilisÃ© dans B2C ET B2B
  // Juste les couleurs changent selon le thÃ¨me
}

// packages/shared/utils/formatPrice.ts
export function formatPrice(price: number, isB2B: boolean) {
  if (isB2B) {
    return `${price.toFixed(2)} â‚¬ HT`;
  }
  return `${price.toFixed(2)} â‚¬`;
}

// packages/shared/api-client/products.ts
export async function getProducts(userRole: 'b2c' | 'b2b') {
  const { data } = await supabase
    .from('products')
    .select('*');
  
  // Retourne les prix adaptÃ©s au rÃ´le
  return data.map(p => ({
    ...p,
    price: userRole === 'b2b' ? p.price_b2b : p.price_b2c
  }));
}


âŒ DIFFÃ‰RENT (propre Ã  chaque app)
--------------------------------------------------------------------------------

B2C uniquement :
- Page blog beautÃ©
- Rituels de soins
- Newsletter
- Paiement Stripe intÃ©grÃ©
- Design colorÃ©, Ã©motionnel

B2B uniquement :
- Dashboard avec stats
- Commande rapide (CSV upload)
- Gestion factures
- Demande de devis
- TÃ©lÃ©chargement fiches techniques
- Design sobre, professionnel


ğŸ”‘ AVANTAGES DE CETTE ARCHITECTURE
================================================================================

1. ğŸ”’ SÃ©curitÃ© : B2B isolÃ©, impossible d'accÃ©der sans login validÃ©
2. ğŸ’° Prix diffÃ©renciÃ©s : MÃªme produit, 2 prix selon le client
3. ğŸ¨ UX optimisÃ©e : Design adaptÃ© Ã  chaque audience
4. ğŸ“Š Analytics sÃ©parÃ©s : Suivi B2C vs B2B
5. ğŸš€ Deploy indÃ©pendant : Mise Ã  jour B2C sans toucher B2B
6. â™»ï¸ Code rÃ©utilisÃ© : Composants/logique partagÃ©s = moins de bugs
7. ğŸ“ˆ Ã‰volutivitÃ© : Facile d'ajouter un 3Ã¨me site (B2B2C, Marketplace...)


ğŸ› ï¸ TECHNOLOGIES PROPOSÃ‰ES
================================================================================

Frontend (B2C + B2B)
â”œâ”€â”€ Next.js 16 (dÃ©jÃ  en place âœ…)
â”œâ”€â”€ TailwindCSS (dÃ©jÃ  en place âœ…)
â””â”€â”€ React 19 (dÃ©jÃ  en place âœ…)

Backend
â”œâ”€â”€ Supabase (recommandÃ©) OU Firebase OU API custom
â”‚   â”œâ”€â”€ PostgreSQL (base de donnÃ©es)
â”‚   â”œâ”€â”€ Auth (gestion utilisateurs)
â”‚   â”œâ”€â”€ Storage (images + documents)
â”‚   â””â”€â”€ Edge Functions (logique mÃ©tier)

Packages partagÃ©s
â”œâ”€â”€ TypeScript (types communs)
â”œâ”€â”€ Zod (validation)
â””â”€â”€ Radix UI (composants accessibles)

Paiement
â”œâ”€â”€ Stripe (B2C - paiement direct)
â””â”€â”€ Factures PDF (B2B - paiement diffÃ©rÃ©)


ğŸ“ EN RÃ‰SUMÃ‰ POUR UN NON-TECHNIQUE
================================================================================

Ce que Ã§a veut dire :

Vous avez 2 SITES WEB SÃ‰PARÃ‰S (comme 2 boutiques diffÃ©rentes) :
- Un pour les CLIENTS NORMAUX (joli, facile, paiement rapide)
- Un pour les PROFESSIONNELS (sÃ©rieux, prix rÃ©duits, facturation)

Mais DERRIÃˆRE :
- Ils utilisent le MÃŠME STOCK de produits
- Ils se CONNECTENT Ã€ LA MÃŠME BASE DE DONNÃ‰ES
- Ils PARTAGENT DES MORCEAUX DE CODE (pour Ã©viter de tout coder 2 fois)

AVANTAGE PRINCIPAL : 
Un produit ajoutÃ© au catalogue apparaÃ®t AUTOMATIQUEMENT dans B2C ET B2B, 
mais avec des prix diffÃ©rents.


ğŸ”— NAVIGATION ENTRE B2C ET B2B
================================================================================

OPTION 1 : Lien dans le footer/header (Le plus simple)
--------------------------------------------------------------------------------
www.mishki.com
â”œâ”€â”€ Header
â”‚   â””â”€â”€ "Espace Pro" â†’ redirige vers pro.mishki.com
â””â”€â”€ Footer
    â””â”€â”€ "Vous Ãªtes professionnel ?" â†’ pro.mishki.com

Avantages :
âœ… Simple Ã  implÃ©menter
âœ… Deux sites restent distincts
âœ… SEO optimal pour chaque audience


OPTION 2 : Route /pro dans le mÃªme site (Architecture unifiÃ©e)
--------------------------------------------------------------------------------
www.mishki.com
â”œâ”€â”€ / (B2C - public)
â”œâ”€â”€ /produits (B2C)
â”œâ”€â”€ /blog (B2C)
â””â”€â”€ /pro (B2B - protÃ©gÃ©)
    â”œâ”€â”€ /pro/login
    â”œâ”€â”€ /pro/dashboard
    â”œâ”€â”€ /pro/catalogue
    â””â”€â”€ /pro/factures

Avantages :
âœ… Un seul domaine
âœ… Navigation fluide
âœ… Partage de session (si connectÃ© B2C, peut accÃ©der B2B)

InconvÃ©nients :
âŒ Bundle plus lourd (code B2B chargÃ© mÃªme pour B2C)
âŒ Moins flexible pour les dÃ©ploiements sÃ©parÃ©s


OPTION 3 : Bouton "Passer en mode Pro" avec SSO (â­ RECOMMANDÃ‰)
--------------------------------------------------------------------------------
www.mishki.com (B2C)
â””â”€â”€ Header
    â””â”€â”€ ğŸ¢ "Espace Professionnel"
        â”œâ”€â”€ Si non connectÃ© â†’ Modal login avec lien "CrÃ©er compte pro"
        â””â”€â”€ Si connectÃ© B2B â†’ Redirige vers pro.mishki.com (dÃ©jÃ  auth)

Comment Ã§a marche :
1. Client clique "Espace Pro" sur mishki.com
2. S'il n'est pas connectÃ© â†’ affiche modal de login
3. Login rÃ©ussi â†’ redirige vers pro.mishki.com avec token partagÃ©
4. Le site pro le reconnait automatiquement (SSO - Single Sign-On)

Avantages :
âœ… Meilleur des deux mondes
âœ… Sites sÃ©parÃ©s mais accÃ¨s fluide
âœ… SSO - connexion partagÃ©e entre B2C et B2B


IMPLÃ‰MENTATION RECOMMANDÃ‰E
--------------------------------------------------------------------------------

Dans le B2C (apps/b2c) :

1. Header avec lien Pro :
   
   <nav>
     <Link href="/">Accueil</Link>
     <Link href="/produits">Produits</Link>
     <Link href="/blog">Blog</Link>
     
     <div className="ml-auto flex gap-4">
       <Link href="https://pro.mishki.com">
         ğŸ¢ Espace Professionnel
       </Link>
     </div>
   </nav>


2. BanniÃ¨re pour pros dans le footer :
   
   <div className="bg-[#235730] text-white p-6 text-center">
     <h3>Vous Ãªtes professionnel(le) ?</h3>
     <p>Spa, institut, salon : accÃ©dez Ã  nos tarifs pros</p>
     <Button href="https://pro.mishki.com">
       DÃ©couvrir l'espace pro
     </Button>
   </div>


3. Page dÃ©diÃ©e /devenir-professionnel :
   
   www.mishki.com/devenir-professionnel
   â†’ Explique les avantages B2B
   â†’ Formulaire d'inscription
   â†’ Bouton "AccÃ©der Ã  mon espace" (si dÃ©jÃ  inscrit)


SSO (Connexion partagÃ©e) - Flux technique
--------------------------------------------------------------------------------

1. User se connecte sur mishki.com (B2C)
2. Token JWT stockÃ© dans cookie partagÃ© (*.mishki.com)
3. Clique "Espace Pro" â†’ redirige vers pro.mishki.com
4. pro.mishki.com lit le mÃªme cookie
5. Si role = b2b et validated = true â†’ accÃ¨s direct au dashboard
6. Sinon â†’ message "AccÃ¨s rÃ©servÃ© aux professionnels validÃ©s"

SÃ©curitÃ© :
- Cookie httpOnly + secure + sameSite=lax
- Token expirÃ© aprÃ¨s 7 jours
- Refresh token pour renouvellement automatique


================================================================================
Document crÃ©Ã© le 16/12/2025
Projet : Mishki Monorepo
================================================================================
